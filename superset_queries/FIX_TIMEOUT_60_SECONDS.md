# Решение проблемы таймаута 60 секунд для Charts

## Проблема

```
Timeout error: We're having trouble loading this visualization. 
Queries are set to timeout after 60 seconds.
```

## ⚠️ ВАЖНО: Это нужно настроить в Superset UI!

Настройки в `superset_config.py` влияют только на SQL Lab, но НЕ на Chart queries. Для Charts нужно настроить в UI.

---

## Решение: Настроить Database Connection в Superset UI

### Шаг 1: Откройте настройки Database

1. Войдите в Superset
2. Перейдите в **Data** → **Databases**
3. Найдите вашу базу данных: **"Ubidex Events DB"**
4. **Кликните на название** базы данных для редактирования

### Шаг 2: Включите асинхронные запросы (ОБЯЗАТЕЛЬНО!)

1. Прокрутите вниз до раздела **"Advanced"**
2. Найдите раздел **"Query Execution Options"**
3. **Включите чекбокс** ✅ **"Asynchronous query execution"**
   - Это критически важно! Без этого запросы будут таймаутиться через 60 секунд
   - Асинхронные запросы выполняются в фоне и не ограничены таймаутом веб-сервера

### Шаг 3: Установите Query Timeout (если доступно)

1. В том же разделе **"Advanced"** найдите поле **"Query Timeout"** или **"SQL Query Timeout"**
2. Введите значение: **600** (10 минут в секундах)
   - Или больше, если запросы очень долгие (1200 = 20 минут, 1800 = 30 минут)
3. Если поля нет - не страшно, асинхронные запросы решат проблему

### Шаг 4: Сохраните изменения

1. Нажмите кнопку **"Save"** внизу страницы
2. Дождитесь подтверждения сохранения

---

## Проверка

1. Откройте Chart, который раньше таймаутился
2. Запрос должен выполняться дольше 60 секунд без ошибки
3. Если запрос очень долгий, вы увидите индикатор загрузки вместо ошибки

---

## Дополнительные настройки (опционально)

### Настройка Cache Timeout

В разделе **"Advanced"** также можно настроить:
- **Chart cache timeout**: 3600 (1 час) - кеширование результатов Chart
- **Schema cache timeout**: 3600 (1 час) - кеширование схемы БД
- **Table cache timeout**: 3600 (1 час) - кеширование таблиц

Это ускорит работу с уже выполненными запросами.

---

## Если проблема сохраняется

1. **Проверьте логи Railway:**
   - Railway Dashboard → ваш сервис → "View logs"
   - Ищите ошибки при выполнении запросов

2. **Проверьте настройки Database:**
   - Убедитесь, что "Asynchronous query execution" включен ✅
   - Убедитесь, что изменения сохранены

3. **Попробуйте упростить запрос:**
   - Добавьте фильтры по дате
   - Уменьшите количество данных
   - Используйте агрегацию вместо детальных данных

---

## Технические детали

- **SQL Lab queries**: Настраиваются через `SQLLAB_TIMEOUT` в `superset_config.py` (уже настроено: 600 секунд)
- **Chart queries**: Настраиваются через UI в Database settings (нужно сделать вручную)
- **Асинхронные запросы**: Критически важны для запросов > 60 секунд

---

## Резюме

**Главное действие:** Включите ✅ **"Asynchronous query execution"** в настройках Database в Superset UI!

Это решит 99% проблем с таймаутом 60 секунд.

